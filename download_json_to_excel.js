const SHEETS_R1={SUMMARY:{row1:["GSTR-1"],row2:["Summary"],widths:[15,13,15,15,15,13,13,15]},B2B:{row1:["B2B Invoice details Form GSTR-1"],row2:["Taxable supplies made to registered taxpayers (invoices only) - B2B"],row3:["GSTIN/UIN of Recipient","Receiver Name","Invoice Number","Invoice date","Place Of Supply","Invoice Type","Reverse Charge","Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value","Rate","IRN Date","IRN"],widths:[20.875,25,22,11.625,12,14.875,11.5,13,13,13,13,13,13,13,13,13,80]},B2CS:{row1:["B2CS Invoice details Form GSTR-1"],row2:["Taxable supplies made to registered taxpayers (invoices only) - B2CS"],row3:["Place Of Supply","Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value","Rate"],widths:[21.25,16,12,10.75,11.75,11.5,14,16,10]},B2CL:{row1:["B2CL Invoice details Form GSTR-1"],row2:["Taxable supplies made to registered taxpayers (invoices only) - B2CL"],row3:["Place Of Supply","Invoice Number","Invoice Date","Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value","Rate"],widths:[21.25,26,16,16,12,10.75,11.75,11.5,14,16,10]},NIL:{row1:["NIL Invoice details Form GSTR-1"],row2:["NIL supplies made to registered taxpayers (invoices only) - NIL"],row3:["Supply Types","Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value","Rate"],widths:[21.25,16,12,10.75,11.75,11.5,14,16,10]},CDN:{row1:["CDNR details GSTR-1"],row2:["Credit/ Debit notes issued to the registered taxpayers - CDNR"],row3:["GSTIN/UIN of Recipient","Receiver Name","Note Number","Note Date","Note Type","Place Of Supply","Reverse Charge","Note Supply Type","Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value","Rate","IRN Date","IRN"],widths:[20.875,25,22,11.125,12,14,13,13,13,13,13,13,13,13,13,13,13,80]},B2BA:{row1:["B2BA details GSTR-1"],row2:["Ammended Taxable supplies made to registered taxpayers (invoices only) - B2BA"],row3:["GSTIN/UIN of Recipient","Receiver Name","Invoice Number","Invoice date","Place Of Supply","Invoice Type","Reverse Charge","Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value","Rate","OLD_Invoice","OLD_Date"],widths:[20.875,25,22,11.625,12,14.875,11.5,13,13,13,13,13,13,13,13,22,13]},CDNA:{row1:["CDNRA details GSTR-1"],row2:["Ammended Credit/ Debit notes issued to the registered taxpayers - CDNR"],row3:["GSTIN/UIN of Recipient","Receiver Name","Note Number","Note Date","Note Type","Place Of Supply","Reverse Charge","Note Supply Type","Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value","Rate","IRN Date","IRN"],widths:[20.875,25,22,11.125,12,14,13,13,13,13,13,13,13,13,13,13,13,80]}},FIELD_MAP_R1={B2B:{"GSTIN/UIN of Recipient":e=>e.ctin,"Receiver Name":()=>"","Invoice Number":e=>e.inum,"Invoice date":e=>e.idt,"Place Of Supply":e=>e.pos,"Invoice Type":e=>e.inv_typ,"Reverse Charge":e=>e.rchrg,"Taxable Value":e=>e.itm_det?.txval,"Integrated Tax":e=>e.itm_det?.iamt||0,"Central Tax":e=>e.itm_det?.camt||0,"State/UT Tax":e=>e.itm_det?.samt||0,"Cess Amount":e=>e.itm_det?.csamt||0,GST:e=>(e.itm_det?.iamt||0)+(e.itm_det?.camt||0)+(e.itm_det?.samt||0),"Invoice Value":e=>e.itm_det?.txval+(e.itm_det?.iamt||0)+(e.itm_det?.camt||0)+(e.itm_det?.samt||0),Rate:e=>e.itm_det?.rt,"IRN Date":e=>e.irngendate,IRN:e=>e.irn},B2CS:{"Place Of Supply":e=>e.pos,"Taxable Value":e=>e.txval,"Integrated Tax":e=>e.iamt||0,"Central Tax":e=>e.camt||0,"State/UT Tax":e=>e.samt||0,"Cess Amount":e=>e.csamt||0,GST:e=>(e.iamt||0)+(e.camt||0)+(e.samt||0),"Invoice Value":e=>(e.txval+e.iamt||0)+(e.camt||0)+(e.samt||0)+(e.csamt||0),Rate:e=>e.rt},B2CL:{"Place Of Supply":e=>e.pos,"Invoice Number":e=>e.inum,"Invoice Date":e=>e.idt,"Taxable Value":e=>e.itm_det?.txval||0,"Integrated Tax":e=>e.itm_det?.iamt||0,"Central Tax":e=>e.itm_det?.camt||0,"State/UT Tax":e=>e.itm_det?.samt||0,"Cess Amount":e=>e.itm_det?.csamt||0,GST:e=>(e.itm_det?.iamt||0)+(e.itm_det?.camt||0)+(e.itm_det?.samt||0),"Invoice Value":e=>(e.itm_det?.txval+e.itm_det?.iamt||0)+(e.itm_det?.camt||0)+(e.itm_det?.samt||0)+(e.itm_det?.csamt||0),Rate:e=>e.itm_det?.rt},NIL1:{"Supply Types":e=>e.sply_ty+" Exempt"||0,"Taxable Value":e=>e.expt_amt||0,"Integrated Tax":0,"Central Tax":0,"State/UT Tax":0,"Cess Amount":0,GST:0,"Invoice Value":e=>e.expt_amt||0,Rate:0},NIL2:{"Supply Types":e=>e.sply_ty+" NIL"||0,"Taxable Value":e=>e.nil_amt||0,"Integrated Tax":0,"Central Tax":0,"State/UT Tax":0,"Cess Amount":0,GST:0,"Invoice Value":e=>e.nil_amt||0,Rate:0},NIL3:{"Supply Types":e=>e.sply_ty+" NA"||0,"Taxable Value":e=>e.ngsup_amt||0,"Integrated Tax":0,"Central Tax":0,"State/UT Tax":0,"Cess Amount":0,GST:0,"Invoice Value":e=>e.ngsup_amt||0,Rate:0},CDN:{"GSTIN/UIN of Recipient":e=>e.ctin,"Receiver Name":()=>"","Note Number":e=>e.nt_num,"Note Date":e=>e.nt_dt,"Note Type":e=>e.ntty,"Place Of Supply":e=>e.pos,"Reverse Charge":e=>e.rchrg,"Note Supply Type":e=>e.inv_typ,"Taxable Value":e=>e.itm_det?.txval,"Integrated Tax":e=>e.itm_det?.iamt||0,"Central Tax":e=>e.itm_det?.camt||0,"State/UT Tax":e=>e.itm_det?.samt||0,"Cess Amount":e=>e.itm_det?.csamt||0,GST:e=>(e.itm_det?.iamt||0)+(e.itm_det?.camt||0)+(e.itm_det?.samt||0),"Invoice Value":e=>e.itm_det?.txval+(e.itm_det?.iamt||0)+(e.itm_det?.camt||0)+(e.itm_det?.samt||0),Rate:e=>e.itm_det?.rt,"IRN Date":e=>e.irngendate,IRN:e=>e.irn},B2BA:{"GSTIN/UIN of Recipient":e=>e.ctin,"Receiver Name":()=>"","Invoice Number":e=>e.inum,"Invoice date":e=>e.idt,"Place Of Supply":e=>e.pos,"Invoice Type":e=>e.inv_typ,"Reverse Charge":e=>e.rchrg,"Taxable Value":e=>e.itm_det?.txval,"Integrated Tax":e=>e.itm_det?.iamt||0,"Central Tax":e=>e.itm_det?.camt||0,"State/UT Tax":e=>e.itm_det?.samt||0,"Cess Amount":e=>e.itm_det?.csamt||0,GST:e=>(e.itm_det?.iamt||0)+(e.itm_det?.camt||0)+(e.itm_det?.samt||0),"Invoice Value":e=>e.itm_det?.txval+(e.itm_det?.iamt||0)+(e.itm_det?.camt||0)+(e.itm_det?.samt||0),Rate:e=>e.itm_det?.rt,OLD_Invoice:e=>e.oinum,OLD_Date:e=>e.oidt},CDNA:{"GSTIN/UIN of Recipient":e=>e.ctin,"Receiver Name":()=>"","Note Number":e=>e.nt_num,"Note Date":e=>e.nt_dt,"Note Type":e=>e.ntty,"Place Of Supply":e=>e.pos,"Reverse Charge":e=>e.rchrg,"Note Supply Type":e=>e.inv_typ,"Taxable Value":e=>e.itm_det?.txval,"Integrated Tax":e=>e.itm_det?.iamt||0,"Central Tax":e=>e.itm_det?.camt||0,"State/UT Tax":e=>e.itm_det?.samt||0,"Cess Amount":e=>e.itm_det?.csamt||0,GST:e=>(e.itm_det?.iamt||0)+(e.itm_det?.camt||0)+(e.itm_det?.samt||0),"Invoice Value":e=>e.itm_det?.txval+(e.itm_det?.iamt||0)+(e.itm_det?.camt||0)+(e.itm_det?.samt||0),Rate:e=>e.itm_det?.rt,"IRN Date":e=>e.irngendate,IRN:e=>e.irn}};function xlsx_read_r1_json(e){const t=e,a=new ExcelJS.Workbook;a.creator="json-to-excel";const l={};for(const[e,t]of Object.entries(SHEETS_R1)){const o=a.addWorksheet(e);l[e]=o,o.columns=t.widths.map((e=>({width:e})));let i=o.addRow(t.row1);o.mergeCells(1,1,1,t.widths.length),i.eachCell((e=>{e.font={bold:!0,size:18,color:{argb:"FFFFFFFF"}},e.alignment={horizontal:"center",vertical:"middle"},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF041D6E"}}}));let r=o.addRow(t.row2);o.mergeCells(2,1,2,t.widths.length),r.eachCell((e=>{e.font={bold:!0},e.alignment={horizontal:"center",vertical:"middle"},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"e7eba7"}}})),o.views=[{state:"frozen",ySplit:3}];let n=o.addRow(t.row3);n.font={bold:!0,color:{argb:"FFFFFFFF"}},n.alignment={horizontal:"center",vertical:"middle",wrapText:!0},n.eachCell((e=>{e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF041D6E"}},e.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}))}if(t.b2b&&Array.isArray(t.b2b)){const e=l.B2B;let a={};t.b2b.forEach((t=>{(t.inv||[]).forEach((l=>{(l.itms||[]).forEach((o=>{const i={...l,ctin:t.ctin,itm_det:o.itm_det},r=SHEETS_R1.B2B.row3.map((e=>FIELD_MAP_R1.B2B[e]?FIELD_MAP_R1.B2B[e](i):""));e.addRow(r),["Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value"].forEach((e=>{let t=FIELD_MAP_R1.B2B[e]?FIELD_MAP_R1.B2B[e](i):0;"number"==typeof t&&(a[e]=(a[e]||0)+t)}))}))}))})),addTotalRow_R1(e,SHEETS_R1.B2B.row3,a,l.SUMMARY,8,"B2B")}if(t.b2cs&&Array.isArray(t.b2cs)){const e=l.B2CS;let a={};t.b2cs.forEach((t=>{const l=SHEETS_R1.B2CS.row3.map((e=>FIELD_MAP_R1.B2CS[e]?FIELD_MAP_R1.B2CS[e](t):""));e.addRow(l),["Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value"].forEach((e=>{let l=FIELD_MAP_R1.B2CS[e]?FIELD_MAP_R1.B2CS[e](t):0;"number"==typeof l&&(a[e]=(a[e]||0)+l)}))})),addTotalRow_R1(e,SHEETS_R1.B2CS.row3,a,l.SUMMARY,9,"B2CS")}if(t.b2cl&&Array.isArray(t.b2cl)){const e=l.B2CL;let a={};t.b2cl.forEach((t=>{(t.inv||[]).forEach((l=>{(l.itms||[]).forEach((o=>{const i={...l,pos:t.pos,idt:l.idt,inum:l.inum,itm_det:o.itm_det},r=SHEETS_R1.B2CL.row3.map((e=>FIELD_MAP_R1.B2CL[e]?FIELD_MAP_R1.B2CL[e](i):""));e.addRow(r),["Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value"].forEach((e=>{let t=FIELD_MAP_R1.B2CL[e]?FIELD_MAP_R1.B2CL[e](i):0;"number"==typeof t&&(a[e]=(a[e]||0)+t)}))}))}))})),addTotalRow_R1(e,SHEETS_R1.B2CL.row3,a,l.SUMMARY,13,"B2CL")}if(t.nil){const e=l.NIL;let a={};t.nil.inv.forEach((t=>{const l=SHEETS_R1.NIL.row3.map((e=>FIELD_MAP_R1.NIL1[e]?FIELD_MAP_R1.NIL1[e](t):""));e.addRow(l),["Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value"].forEach((e=>{let l=FIELD_MAP_R1.NIL1[e]?FIELD_MAP_R1.NIL1[e](t):0;"number"==typeof l&&(a[e]=(a[e]||0)+l)}));const o=SHEETS_R1.NIL.row3.map((e=>FIELD_MAP_R1.NIL2[e]?FIELD_MAP_R1.NIL2[e](t):""));e.addRow(o),["Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value"].forEach((e=>{let l=FIELD_MAP_R1.NIL2[e]?FIELD_MAP_R1.NIL2[e](t):0;"number"==typeof l&&(a[e]=(a[e]||0)+l)}));const i=SHEETS_R1.NIL.row3.map((e=>FIELD_MAP_R1.NIL3[e]?FIELD_MAP_R1.NIL3[e](t):""));e.addRow(i),["Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value"].forEach((e=>{let l=FIELD_MAP_R1.NIL3[e]?FIELD_MAP_R1.NIL3[e](t):0;"number"==typeof l&&(a[e]=(a[e]||0)+l)}))})),addTotalRow_R1(e,SHEETS_R1.NIL.row3,a,l.SUMMARY,12,"NIL")}if(t.cdnr&&Array.isArray(t.cdnr)){const e=l.CDN;let a={},o={};t.cdnr.forEach((t=>{(t.nt||[]).forEach((l=>{(l.itms||[]).forEach((i=>{const r={...l,ctin:t.ctin,itm_det:i.itm_det},n=SHEETS_R1.CDN.row3.map((e=>FIELD_MAP_R1.CDN[e]?FIELD_MAP_R1.CDN[e](r):""));e.addRow(n);let s="D"===(FIELD_MAP_R1.CDN["Note Type"]?FIELD_MAP_R1.CDN["Note Type"](r):"")?a:o;["Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value"].forEach((e=>{let t=FIELD_MAP_R1.CDN[e]?FIELD_MAP_R1.CDN[e](r):0;"number"==typeof t&&(s[e]=(s[e]||0)+t)}))}))}))})),Object.keys(a).length>0&&addTotalRow_R1(e,SHEETS_R1.CDN.row3,a,l.SUMMARY,11,"DN"),Object.keys(o).length>0&&addTotalRow_R1(e,SHEETS_R1.CDN.row3,o,l.SUMMARY,10,"CN")}if(t.b2ba&&Array.isArray(t.b2ba)){const e=l.B2BA;let a={};t.b2ba.forEach((t=>{(t.inv||[]).forEach((l=>{(l.itms||[]).forEach((o=>{const i={...l,ctin:t.ctin,itm_det:o.itm_det},r=SHEETS_R1.B2BA.row3.map((e=>FIELD_MAP_R1.B2BA[e]?FIELD_MAP_R1.B2BA[e](i):""));e.addRow(r),["Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value"].forEach((e=>{let t=FIELD_MAP_R1.B2BA[e]?FIELD_MAP_R1.B2BA[e](i):0;"number"==typeof t&&(a[e]=(a[e]||0)+t)}))}))}))})),addTotalRow_R1(e,SHEETS_R1.B2BA.row3,a,l.SUMMARY,14,"B2BA")}if(t.cdnra&&Array.isArray(t.cdnra)){const e=l.CDNA;let a={},o={};t.cdnra.forEach((t=>{(t.nt||[]).forEach((l=>{(l.itms||[]).forEach((i=>{const r={...l,ctin:t.ctin,itm_det:i.itm_det},n=SHEETS_R1.CDNA.row3.map((e=>FIELD_MAP_R1.CDNA[e]?FIELD_MAP_R1.CDNA[e](r):""));e.addRow(n);let s="D"===(FIELD_MAP_R1.CDNA["Note Type"]?FIELD_MAP_R1.CDNA["Note Type"](r):"")?a:o;["Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value"].forEach((e=>{let t=FIELD_MAP_R1.CDNA[e]?FIELD_MAP_R1.CDNA[e](r):0;"number"==typeof t&&(s[e]=(s[e]||0)+t)}))}))}))})),Object.keys(a).length>0&&addTotalRow_R1(e,SHEETS_R1.CDNA.row3,a,l.SUMMARY,15,"DNA"),Object.keys(o).length>0&&addTotalRow_R1(e,SHEETS_R1.CDNA.row3,o,l.SUMMARY,16,"CNA")}const o=l.SUMMARY;function i(e,t,a,l){let o=t,i=0,r=0,n=0,s=0,d=0;a.forEach((t=>{const a=(t.iamt||0)+(t.camt||0)+(t.samt||0),l=(t.txval||0)+a+(t.csamt||0);e.getRow(o).values=[t.hsn_sc,t.txval||0,t.iamt||0,t.camt||0,t.samt||0,t.csamt||0,a,l,t.rt||0,t.user_desc||""],e.getRow(o).alignment={horizontal:"right"},o++,i+=t.txval||0,r+=t.iamt||0,n+=t.camt||0,s+=t.samt||0,d+=t.csamt||0}));const c=r+n+s,m=c+i+d;e.getRow(o).values=[l,i,r,n,s,d,c,m];const T=e.getRow(o);return T.font={bold:!0},T.alignment={horizontal:"right"},o+1}t.hsn?.data&&Array.isArray(t.hsn?.data)&&i(o,19,t.hsn.data,"B2B"),t.hsn?.hsn_b2b&&Array.isArray(t.hsn?.hsn_b2b)&&i(o,19,t.hsn.hsn_b2b,"B2B"),t.hsn?.hsn_b2c&&Array.isArray(t.hsn?.hsn_b2c)&&i(o,35,t.hsn.hsn_b2c,"B2CS"),o.getRow(4).values=["Period",t.fp,,,,"File Date:",t.fil_dt],o.getRow(5).values=["Name",session.businessName,,,,"GSTIN",t.gstin],o.getRow(7).values=["Section","Taxable Value","IGST","CGST","SGST","CESS","GST","TOTAL"],o.getRow(7).eachCell((e=>{e.font={bold:!0,color:{argb:"FFFFFFFF"}},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF041D6E"}},e.alignment={horizontal:"center"}})),o.getRow(18).values=["HSN Wise","Taxable Value","IGST","CGST","SGST","CESS","GST","TOTAL","Rate","Desc"],o.getRow(18).eachCell((e=>{e.font={bold:!0,color:{argb:"FFFFFFFF"}},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF041D6E"}},e.alignment={horizontal:"center"}})),a.xlsx.writeBuffer().then((e=>{saveAs(new Blob([e]),`${t.fp}_GSTR1_${t.gstin}.xlsx`),document.getElementById("result").textContent="Downloaded ✅"}))}function addTotalRow_R1(e,t,a,l,o,i){const r=t.map(((e,t)=>0===t?"TOTAL":a[e]||"")),n=e.addRow(r),s=e.getRow(3);if(n.eachCell(((e,t)=>{e.font={bold:!0},s.getCell(t).value&&(e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFE699"}})})),l&&o){const e=a["Taxable Value"]||0,t=a["Integrated Tax"]||0,r=a["Central Tax"]||0,n=a["State/UT Tax"]||0,s=a["Cess Amount"]||0,d=a.GST||0,c=e+t+r+n+s,m=l.getRow(o);m.getCell(1).value=i,"CN"===i?(m.getCell(2).value=-e,m.getCell(3).value=-t,m.getCell(4).value=-r,m.getCell(5).value=-n,m.getCell(6).value=-s,m.getCell(7).value=-d,m.getCell(8).value=-c):(m.getCell(2).value=e,m.getCell(3).value=t,m.getCell(4).value=r,m.getCell(5).value=n,m.getCell(6).value=s,m.getCell(7).value=d,m.getCell(8).value=c),m.commit()}}const today_r2a=new Date,SHEETS_R2A={SUMMARY:{row1:["GSTR-2A"],row2:["Summary"],widths:[15,13,15,15,15,13,13,15]},B2B:{row1:["B2B Invoice details Form GSTR-2A"],row2:["Taxable supplies made to registered taxpayers (invoices only) - B2B"],row3:["GSTIN/UIN of Recipient","Trade/Legal name","Invoice Number","Invoice date","Place Of Supply","Invoice Type","Reverse Charge","Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value","Rate","ITC Availability","Filing Period","Filing Date","IRN Date","IRN"],widths:[20.875,35,22,11.625,12,14.875,11.5,13,13,13,13,13,13,13,13,13,13,13,13,80]},CDN:{row1:["CDNR details GSTR-2A"],row2:["Credit/ Debit notes issued to the registered taxpayers - CDNR"],row3:["GSTIN/UIN of Recipient","Receiver Name","Note Number","Note Date","Note Type","Place Of Supply","Reverse Charge","Note Supply Type","Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value","Rate","ITC Availability","Filing Period","Filing Date","IRN Date","IRN"],widths:[20.875,35,22,11.125,12,14,13,13,13,13,13,13,13,13,13,13,13,13,13,13,80]},ECOM:{row1:["ECOM details GSTR-2A"],row2:["e-Commerce Invoices issued to the registered taxpayers - ECOM"],row3:["GSTIN/UIN of Recipient","Receiver Name","Invoice Number","Invoice Date","Place Of Supply","Invoice Type","Reverse Charge","Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value","Rate","ITC Availability","Filing Period","Filing Date"],widths:[20.875,25,22,11.625,12,14.875,11.5,13,13,13,13,13,13,13,13,13,13,13]},TDS:{row1:["TDS details GSTR-2A"],row2:["TDS Deducted by registered taxpayers"],row3:["GSTIN of Deductor","Deductor Name","Month","Amount Deudcted","Integrated Tax","Central Tax","State/UT Tax","GST"],widths:[20.875,25,22,11.625,12,14.875,11.5,13]}};function formatSupprd(e){if(!e||6!==e.length)return e||"";const t=e.slice(0,2),a=e.slice(2,6).slice(-2);return({"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep",10:"Oct",11:"Nov",12:"Dec"}[t]||t)+"'"+a}const FIELD_MAP_R2A={B2B:{"GSTIN/UIN of Recipient":e=>e.ctin,"Trade/Legal name":e=>e.trdnm,"Invoice Number":e=>e.inum,"Invoice date":e=>e.idt,"Place Of Supply":e=>e.pos,"Invoice Type":e=>e.inv_typ,"Reverse Charge":e=>e.rchrg,"Taxable Value":e=>e.itm_det?.txval,"Integrated Tax":e=>e.itm_det?.iamt||0,"Central Tax":e=>e.itm_det?.camt||0,"State/UT Tax":e=>e.itm_det?.samt||0,"Cess Amount":e=>e.itm_det?.csamt||0,GST:e=>(e.itm_det?.iamt||0)+(e.itm_det?.camt||0)+(e.itm_det?.samt||0),"Invoice Value":e=>(e.itm_det?.txval||0)+(e.itm_det?.iamt||0)+(e.itm_det?.camt||0)+(e.itm_det?.samt||0),Rate:e=>e.itm_det?.rt,"ITC Availability":e=>e.itc_cfs3b,"Filing Period":e=>e.fperiod,"Filing Date":e=>e.fdate,"IRN Date":e=>e.irngendate,IRN:e=>e.irn},CDN:{"GSTIN/UIN of Recipient":e=>e.ctin,"Trade Name":e=>e.trdnm,"Note Number":e=>e.nt_num,"Note Date":e=>e.nt_dt,"Note Type":e=>e.ntty,"Place Of Supply":e=>e.pos,"Reverse Charge":e=>e.rchrg,"Note Supply Type":e=>e.inv_typ,"Taxable Value":e=>e.itm_det?.txval,"Integrated Tax":e=>e.itm_det?.iamt||0,"Central Tax":e=>e.itm_det?.camt||0,"State/UT Tax":e=>e.itm_det?.samt||0,"Cess Amount":e=>e.itm_det?.scamt||0,GST:e=>(e.itm_det?.iamt||0)+(e.itm_det?.camt||0)+(e.itm_det?.samt||0),"Invoice Value":e=>(e.itm_det?.txval||0)+(e.itm_det?.iamt||0)+(e.itm_det?.camt||0)+(e.itm_det?.samt||0)+(e.itm_det?.scamt||0),Rate:e=>e.itm_det?.rt,"ITC Availability":e=>e.itcavl,"Filing Period":e=>e.fperiod,"Filing Date":e=>e.fdate,"IRN Date":e=>e.irngendate,IRN:e=>e.irn},ECOM:{"GSTIN/UIN of Recipient":e=>e.ctin,"Trade Name":e=>e.trdnm,"Invoice Number":e=>e.inum,"Invoice Date":e=>e.idt,"Note Type":"ecom","Place Of Supply":e=>e.pos,"Reverse Charge":e=>e.rchrg,"Invoice Type":e=>e.inv_typ,"Taxable Value":e=>e.itm_det?.txval,"Integrated Tax":e=>e.itm_det?.iamt||0,"Central Tax":e=>e.itm_det?.camt||0,"State/UT Tax":e=>e.itm_det?.samt||0,"Cess Amount":e=>e.itm_det?.scamt||0,GST:e=>(e.itm_det?.iamt||0)+(e.itm_det?.camt||0)+(e.itm_det?.samt||0),"Invoice Value":e=>(e.itm_det?.txval||0)+(e.itm_det?.iamt||0)+(e.itm_det?.camt||0)+(e.itm_det?.samt||0),Rate:e=>e.itm_det?.rt,"ITC Availability":e=>e.itcavl,"Filing Period":e=>e.fperiod,"Filing Date":e=>e.fdate},TDS:{"GSTIN of Deductor":e=>e.gstin_deductor,"Deductor Name":e=>e.deductor_name,Month:e=>e.month,"Taxable Value":e=>e.amt_ded,"Integrated Tax":e=>e.iamt||0,"Central Tax":e=>e.camt||0,"State/UT Tax":e=>e.samt||0,"Cess Amount":e=>e.scamt||0,GST:e=>(e.iamt||0)+(e.camt||0)+(e.samt||0)}};function xlsx_read_r2a_json(e){const t=e,a=new ExcelJS.Workbook;a.creator="json-to-excel";const l={};for(const[e,t]of Object.entries(SHEETS_R2A)){const o=a.addWorksheet(e);l[e]=o,o.columns=t.widths.map((e=>({width:e})));let i=o.addRow(t.row1);o.mergeCells(1,1,1,t.widths.length),i.eachCell((e=>{e.font={bold:!0,size:18,color:{argb:"FFFFFFFF"}},e.alignment={horizontal:"center",vertical:"middle"},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF041D6E"}}}));let r=o.addRow(t.row2);o.mergeCells(2,1,2,t.widths.length),r.eachCell((e=>{e.font={bold:!0},e.alignment={horizontal:"center",vertical:"middle"},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"e7eba7"}}})),o.views=[{state:"frozen",ySplit:3}];let n=o.addRow(t.row3);n.font={bold:!0,color:{argb:"FFFFFFFF"}},n.alignment={horizontal:"center",vertical:"middle",wrapText:!0},n.eachCell((e=>{e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF041D6E"}},e.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}))}if(t.b2b&&Array.isArray(t.b2b)){const e=l.B2B;let a={};t.b2b.forEach((t=>{(t.inv||[]).forEach((l=>{(l.itms||[]).forEach((o=>{const i={...l,itm_det:o.itm_det,ctin:t.ctin,trdnm:t.trdnm,fdate:t.fldtr1,fperiod:t.flprdr1,itc_cfs3b:t.cfs3b},r=SHEETS_R2A.B2B.row3.map((e=>FIELD_MAP_R2A.B2B[e]?FIELD_MAP_R2A.B2B[e](i):""));e.addRow(r),["Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value"].forEach((e=>{let t=FIELD_MAP_R2A.B2B[e]?FIELD_MAP_R2A.B2B[e](i):0;"number"==typeof t&&(a[e]=(a[e]||0)+t)}))}))}))})),addTotalRow_R2A(e,SHEETS_R2A.B2B.row3,a,l.SUMMARY,8,"B2B")}if(t.cdn&&Array.isArray(t.cdn)){const e=l.CDN;let a={},o={};t.cdn.forEach((t=>{(t.nt||[]).forEach((l=>{(l.itms||[]).forEach((i=>{const r={...l,itm_det:i.itm_det,ctin:t.ctin,trdnm:t.trdnm,fdate:t.fldtr1,fperiod:t.flprdr1,itcavl:t.cfs3b},n=SHEETS_R2A.CDN.row3.map((e=>FIELD_MAP_R2A.CDN[e]?FIELD_MAP_R2A.CDN[e](r):""));e.addRow(n);let s="D"===(FIELD_MAP_R2A.CDN["Note Type"]?FIELD_MAP_R2A.CDN["Note Type"](r):"")?a:o;["Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value"].forEach((e=>{let t=FIELD_MAP_R2A.CDN[e]?FIELD_MAP_R2A.CDN[e](r):0;"number"==typeof t&&(s[e]=(s[e]||0)+t)}))}))}))})),Object.keys(a).length>0&&addTotalRow_R2A(e,SHEETS_R2A.CDN.row3,a,l.SUMMARY,9,"DN"),Object.keys(o).length>0&&addTotalRow_R2A(e,SHEETS_R2A.CDN.row3,o,l.SUMMARY,10,"CN")}if(t.eco&&Array.isArray(t.eco)){const e=l.ECOM;let a={};t.eco.forEach((t=>{(t.inv||[]).forEach((l=>{(l.itms||[]).forEach((o=>{const i={...l,itm_det:o.itm_det,ctin:t.ctin,trdnm:t.trdnm,fdate:t.fldtr1,fperiod:t.flprdr1,itcavl:t.cfs3b},r=SHEETS_R2A.ECOM.row3.map((e=>FIELD_MAP_R2A.ECOM[e]?FIELD_MAP_R2A.ECOM[e](i):""));e.addRow(r),["Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value"].forEach((e=>{let t=FIELD_MAP_R2A.ECOM[e]?FIELD_MAP_R2A.ECOM[e](i):0;"number"==typeof t&&(a[e]=(a[e]||0)+t)}))}))}))})),addTotalRow_R2A(e,SHEETS_R2A.ECOM.row3,a,l.SUMMARY,11,"ECOM")}if(t.tds&&Array.isArray(t.tds)){const e=l.TDS;let a={};t.tds.forEach((t=>{const l={...t},o=SHEETS_R2A.TDS.row3.map((e=>FIELD_MAP_R2A.TDS[e]?FIELD_MAP_R2A.TDS[e](l):""));e.addRow(o),["Taxable Value","Integrated Tax","Central Tax","State/UT Tax","GST"].forEach((e=>{let t=FIELD_MAP_R2A.TDS[e]?FIELD_MAP_R2A.TDS[e](l):0;"number"==typeof t&&(a[e]=(a[e]||0)+t)}))})),addTotalRow_R2A(e,SHEETS_R2A.TDS.row3,a,l.SUMMARY,15,"TDS")}const o=l.SUMMARY;o.getRow(4).values=["Period",t.fp,,,,"File Gen. Date:",today_r2a.toLocaleDateString("en-IN")],o.getRow(5).values=["Name",session.businessName,,,,"GSTIN",t.gstin],o.getRow(7).values=["Section","Taxable Value","IGST","CGST","SGST","CESS","GST","TOTAL"],o.getRow(7).eachCell((e=>{e.font={bold:!0,color:{argb:"FFFFFFFF"}},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF041D6E"}},e.alignment={horizontal:"center"}})),a.xlsx.writeBuffer().then((e=>{saveAs(new Blob([e]),`${t.fp}_GSTR2A_${t.gstin}.xlsx`),document.getElementById("result").textContent="Downloaded ✅"}))}function addTotalRow_R2A(e,t,a,l,o,i){const r=t.map(((e,t)=>0===t?"TOTAL":a[e]||"")),n=e.addRow(r),s=e.getRow(3);if(n.eachCell(((e,t)=>{e.font={bold:!0},s.getCell(t).value&&(e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFE699"}})})),l&&o){const e=a["Taxable Value"]||0,t=a["Integrated Tax"]||0,r=a["Central Tax"]||0,n=a["State/UT Tax"]||0,s=a["Cess Amount"]||0,d=a.GST||0,c=e+t+r+n+s,m=l.getRow(o);m.getCell(1).value=i,"CN"===i?(m.getCell(2).value=-e,m.getCell(3).value=-t,m.getCell(4).value=-r,m.getCell(5).value=-n,m.getCell(6).value=-s,m.getCell(7).value=-d,m.getCell(8).value=-c):(m.getCell(2).value=e,m.getCell(3).value=t,m.getCell(4).value=r,m.getCell(5).value=n,m.getCell(6).value=s,m.getCell(7).value=d,m.getCell(8).value=c),m.commit()}}const SHEETS_R2B={SUMMARY:{row1:["GSTR-2B"],row2:["Summary"],widths:[15,13,15,15,15,13,13,15]},B2B:{row1:["B2B Invoice details Form GSTR-2B"],row2:["Taxable supplies made to registered taxpayers (invoices only) - B2B"],row3:["GSTIN/UIN of Recipient","Trade/Legal name","Invoice Number","Invoice date","Place Of Supply","Invoice Type","Reverse Charge","Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value","ITC Availability","Filing Period","Filing Date","IRN Date","IRN"],widths:[20.875,35,22,11.625,12,14.875,11.5,13,13,13,13,13,13,13,13,13,13,13,80]},CDN:{row1:["CDNR details GSTR-2B"],row2:["Credit/ Debit notes issued to the registered taxpayers - CDNR"],row3:["GSTIN/UIN of Recipient","Receiver Name","Note Number","Note Date","Note Type","Place Of Supply","Reverse Charge","Note Supply Type","Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value","ITC Availability","Filing Period","Filing Date","IRN Date","IRN"],widths:[20.875,35,22,11.125,12,14,13,13,13,13,13,13,13,13,13,13,13,13,13,80]},ECOM:{row1:["ECOM details GSTR-2B"],row2:["e-Commerce Invoices issued to the registered taxpayers - ECOM"],row3:["GSTIN/UIN of Recipient","Receiver Name","Invoice Number","Invoice Date","Place Of Supply","Invoice Type","Reverse Charge","Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value","ITC Availability","Filing Period","Filing Date"],widths:[20.875,25,22,11.625,12,14.875,11.5,13,13,13,13,13,13,13,13,13,13]}};function formatSupprd_R2B(e){if(!e||6!==e.length)return e||"";const t=e.slice(0,2),a=e.slice(2,6).slice(-2);return({"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep",10:"Oct",11:"Nov",12:"Dec"}[t]||t)+"'"+a}const FIELD_MAP_R2B={B2B:{"GSTIN/UIN of Recipient":e=>e.ctin,"Trade/Legal name":e=>e.trdnm,"Invoice Number":e=>e.inum,"Invoice date":e=>e.dt,"Place Of Supply":e=>e.pos,"Invoice Type":e=>e.typ,"Reverse Charge":e=>e.rev,"Taxable Value":e=>e.txval||e.items?.[0]?.txval,"Integrated Tax":e=>e.igst||e.items?.[0]?.igst||0,"Central Tax":e=>e.cgst||e.items?.[0]?.cgst||0,"State/UT Tax":e=>e.sgst||e.items?.[0]?.sgst||0,"Cess Amount":e=>e.cess||e.items?.[0]?.cess||0,GST:e=>(e.igst||e.items?.[0]?.igst||0)+(e.cgst||e.items?.[0]?.cgst||0)+(e.sgst||e.items?.[0]?.sgst||0),"Invoice Value":e=>e.val,"ITC Availability":e=>e.itcavl,"Filing Period":e=>formatSupprd_R2B(e.fperiod),"Filing Date":e=>e.fdate,"IRN Date":e=>e.irngendate,IRN:e=>e.irn},CDN:{"GSTIN/UIN of Recipient":e=>e.ctin,"Receiver Name":e=>e.trdnm,"Note Number":e=>e.ntnum,"Note Date":e=>e.dt,"Note Type":e=>e.typ,"Place Of Supply":e=>e.pos,"Reverse Charge":e=>e.rev,"Note Supply Type":e=>e.suptyp,"Taxable Value":e=>e.txval||e.items?.[0]?.txval,"Integrated Tax":e=>e.igst||e.items?.[0]?.igst||0,"Central Tax":e=>e.cgst||e.items?.[0]?.cgst||0,"State/UT Tax":e=>e.sgst||e.items?.[0]?.sgst||0,"Cess Amount":e=>e.cess||e.items?.[0]?.cess||0,GST:e=>(e.igst||e.items?.[0]?.igst||0)+(e.cgst||e.items?.[0]?.cgst||0)+(e.sgst||e.items?.[0]?.sgst||0),"Invoice Value":e=>(e.txval||e.items?.[0]?.txval||0)+(e.igst||e.items?.[0]?.igst||0)+(e.cgst||e.items?.[0]?.cgst||0)+(e.sgst||e.items?.[0]?.sgst||0),"ITC Availability":e=>e.itcavl,"Filing Period":e=>formatSupprd_R2B(e.fperiod),"Filing Date":e=>e.fdate,"IRN Date":e=>e.irngendate,IRN:e=>e.irn},ECOM:{"GSTIN/UIN of Recipient":e=>e.ctin,"Receiver Name":e=>e.trdnm,"Invoice Number":e=>e.inum,"Invoice Date":e=>e.dt,"Note Type":"ecom","Place Of Supply":e=>e.pos,"Reverse Charge":e=>e.rev,"Note Supply Type":e=>e.suptyp,"Taxable Value":e=>e.txval||e.items?.[0]?.txval,"Integrated Tax":e=>e.igst||e.items?.[0]?.igst||0,"Central Tax":e=>e.cgst||e.items?.[0]?.cgst||0,"State/UT Tax":e=>e.sgst||e.items?.[0]?.sgst||0,"Cess Amount":e=>e.cess||e.items?.[0]?.cess||0,GST:e=>(e.igst||e.items?.[0]?.igst||0)+(e.cgst||e.items?.[0]?.cgst||0)+(e.sgst||e.items?.[0]?.sgst||0),"Invoice Value":e=>(e.txval||e.items?.[0]?.txval||0)+(e.igst||e.items?.[0]?.igst||0)+(e.cgst||e.items?.[0]?.cgst||0)+(e.sgst||e.items?.[0]?.sgst||0),"ITC Availability":e=>e.itcavl,"Filing Period":e=>formatSupprd_R2B(e.fperiod),"Filing Date":e=>e.fdate}};function xlsx_read_r2b_json(e){const t=e,a=new ExcelJS.Workbook;a.creator="json-to-excel";const l={};for(const[e,t]of Object.entries(SHEETS_R2B)){const o=a.addWorksheet(e);l[e]=o,o.columns=t.widths.map((e=>({width:e})));let i=o.addRow(t.row1);o.mergeCells(1,1,1,t.widths.length),i.eachCell((e=>{e.font={bold:!0,size:18,color:{argb:"FFFFFFFF"}},e.alignment={horizontal:"center",vertical:"middle"},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF041D6E"}}}));let r=o.addRow(t.row2);o.mergeCells(2,1,2,t.widths.length),r.eachCell((e=>{e.font={bold:!0},e.alignment={horizontal:"center",vertical:"middle"},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"e7eba7"}}})),o.views=[{state:"frozen",ySplit:3}];let n=o.addRow(t.row3);n.font={bold:!0,color:{argb:"FFFFFFFF"}},n.alignment={horizontal:"center",vertical:"middle",wrapText:!0},n.eachCell((e=>{e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF041D6E"}},e.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}))}if(t.data.docdata.b2b&&Array.isArray(t.data.docdata.b2b)){const e=l.B2B;let a={};t.data.docdata.b2b.forEach((t=>{(t.inv||[]).forEach((l=>{const o={...l,ctin:t.ctin,trdnm:t.trdnm,fdate:t.supfildt,fperiod:t.supprd},i=SHEETS_R2B.B2B.row3.map((e=>FIELD_MAP_R2B.B2B[e]?FIELD_MAP_R2B.B2B[e](o):""));e.addRow(i),["Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value"].forEach((e=>{let t=FIELD_MAP_R2B.B2B[e]?FIELD_MAP_R2B.B2B[e](o):0;"number"==typeof t&&(a[e]=(a[e]||0)+t)}))}))})),addTotalRow_R2B(e,SHEETS_R2B.B2B.row3,a,l.SUMMARY,8,"B2B")}if(t.data.docdata.cdnr&&Array.isArray(t.data.docdata.cdnr)){const e=l.CDN;let a={},o={};t.data.docdata.cdnr.forEach((t=>{(t.nt||[]).forEach((l=>{const i={...l,ctin:t.ctin,trdnm:t.trdnm,fdate:t.supfildt,fperiod:t.supprd},r=SHEETS_R2B.CDN.row3.map((e=>FIELD_MAP_R2B.CDN[e]?FIELD_MAP_R2B.CDN[e](i):""));e.addRow(r);let n="D"===(FIELD_MAP_R2B.CDN["Note Type"]?FIELD_MAP_R2B.CDN["Note Type"](i):"")?a:o;["Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value"].forEach((e=>{let t=FIELD_MAP_R2B.CDN[e]?FIELD_MAP_R2B.CDN[e](i):0;"number"==typeof t&&(n[e]=(n[e]||0)+t)}))}))})),Object.keys(a).length>0&&addTotalRow_R2B(e,SHEETS_R2B.CDN.row3,a,l.SUMMARY,9,"DN"),Object.keys(o).length>0&&addTotalRow_R2B(e,SHEETS_R2B.CDN.row3,o,l.SUMMARY,10,"CN")}if(t.data.docdata.ecom&&Array.isArray(t.data.docdata.ecom)){const e=l.ECOM;let a={};t.data.docdata.ecom.forEach((t=>{(t.inv||[]).forEach((l=>{const o={...l,ctin:t.ctin,trdnm:t.trdnm,fdate:t.supfildt,fperiod:t.supprd},i=SHEETS_R2B.ECOM.row3.map((e=>FIELD_MAP_R2B.ECOM[e]?FIELD_MAP_R2B.ECOM[e](o):""));e.addRow(i),["Taxable Value","Integrated Tax","Central Tax","State/UT Tax","Cess Amount","GST","Invoice Value"].forEach((e=>{let t=FIELD_MAP_R2B.ECOM[e]?FIELD_MAP_R2B.ECOM[e](o):0;"number"==typeof t&&(a[e]=(a[e]||0)+t)}))}))})),addTotalRow_R2B(e,SHEETS_R2B.ECOM.row3,a,l.SUMMARY,11,"ECOM")}const o=l.SUMMARY;o.getRow(4).values=["Period",t.data.rtnprd,,,,"File Date:",t.data.gendt],o.getRow(5).values=["Name",session.businessName,,,,"GSTIN",t.data.gstin],o.getRow(7).values=["Section","Taxable Value","IGST","CGST","SGST","CESS","GST","TOTAL"],o.getRow(7).eachCell((e=>{e.font={bold:!0,color:{argb:"FFFFFFFF"}},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF041D6E"}},e.alignment={horizontal:"center"}})),a.xlsx.writeBuffer().then((e=>{saveAs(new Blob([e]),`${t.data.rtnprd}_GSTR2B_${t.data.gstin}.xlsx`),document.getElementById("result").textContent="Downloaded ✅"}))}function addTotalRow_R2B(e,t,a,l,o,i){const r=t.map(((e,t)=>0===t?"TOTAL":a[e]||"")),n=e.addRow(r),s=e.getRow(3);if(n.eachCell(((e,t)=>{e.font={bold:!0},s.getCell(t).value&&(e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFE699"}})})),l&&o){const e=a["Taxable Value"]||0,t=a["Integrated Tax"]||0,r=a["Central Tax"]||0,n=a["State/UT Tax"]||0,s=a["Cess Amount"]||0,d=a.GST||0,c=e+t+r+n+s,m=l.getRow(o);m.getCell(1).value=i,"CN"===i?(m.getCell(2).value=-e,m.getCell(3).value=-t,m.getCell(4).value=-r,m.getCell(5).value=-n,m.getCell(6).value=-s,m.getCell(7).value=-d,m.getCell(8).value=-c):(m.getCell(2).value=e,m.getCell(3).value=t,m.getCell(4).value=r,m.getCell(5).value=n,m.getCell(6).value=s,m.getCell(7).value=d,m.getCell(8).value=c),m.commit()}}