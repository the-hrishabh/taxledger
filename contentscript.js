"use strict";var initDone,port,process;function init(){registerProcessors(),chrome.runtime.onConnect.addListener((function(e){(port=e).onMessage.addListener((function(e){var t=process[e.request];t?t(e):(e.status=!1,e.error="Unknown request",port.postMessage(e))}))})),initDone=!0}async function httpGetAsync(e,t){return new Promise((function(s,n){let a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==this.readyState){var e=200==this.status;s({success:e,statusCode:this.status,responseUrl:e?this.responseURL:null,responseData:e?this.response:null})}},a.open("GET",e,!0),a.responseType=t,a.timeout=3e4,a.send()}))}function log(e,t){t?console.log(`${(new Date).toISOString()}: ${e} (${t.constructor.name}) ${JSON.stringify(t)}`):console.log((new Date).toISOString()+": "+e)}async function zipAsync(e,t){let s=new JSZip;return s.file(t,e),await s.generateAsync({type:"blob"})}function saveFile(e,t,s){var n=document.createElement("a"),a=new Blob([t],{type:s});n.href=window.URL.createObjectURL(a),n.download=e,n.style.display="none",document.body.appendChild(n),n.click(),n.parentNode.removeChild(n)}function clickUrl(e,t){var s=document.createElement("a");s.href=e,s.style.display="none",t&&(s.target="_blank"),document.body.appendChild(s),s.click(),s.parentNode.removeChild(s)}function registerProcessors(){(process={}).get=processGet,process.getBlob=processGetBlob,process.log=processLog,process["save-json-as-zip"]=processZipAndSave}async function processGet(e){let t=await httpGetAsync(e.url,"text");e.status=t.success,e.statusCode=t.statusCode,e.response=t.responseData,e.responseUrl=t.responseUrl,port.postMessage(e)}async function processGetBlob(e){let t=await httpGetAsync(e.url,"blob");e.status=t.success,e.statusCode=t.statusCode,e.response=null,e.responseUrl=t.responseUrl,t.responseData&&t.responseData.size>0&&(e.response=URL.createObjectURL(t.responseData)),port.postMessage(e)}function processLog(e){e.status=!0,e.statusCode=200,port.postMessage(e)}async function processZipAndSave(e){let t=await zipAsync(e.jsonData,`${e.jsonfilename}.json`);saveFile(e.zipfilename+".zip",t,"application/zip"),e.status=!0,e.statusCode=200,port.postMessage(e)}async function fetchReceipt(e,t,s,n){try{const s=`https://payment.gst.gov.in/payment/auth/challan/getReceipt?cpin=${t}`,a=await fetch(s,{method:"GET",credentials:"include",mode:"cors",headers:{at:n,accept:"application/json, text/plain",referer:"https://payment.gst.gov.in/payment/auth/acknowledge/view"}});if(!a.ok)throw new Error("HTTP Error "+a.status);const r=await a.json();if(r&&r.cin)return e.pdf_json_data=r,e}catch(e){console.error("âŒ Receipt fetch failed for CPIN:",t,e)}}initDone||init(),chrome.runtime.onMessage.addListener(((e,t,s)=>{if("fetchCashDetails"===e.action){const t=`https://payment.gst.gov.in/payment/auth/api/cashdetls?fdate=${e.from}&tdate=${e.to}`;return fetch(t,{method:"GET",credentials:"include"}).then((e=>e.json())).then((e=>s({success:!0,data:e}))).catch((e=>s({success:!1,error:e.message}))),!0}})),chrome.runtime.onMessage.addListener(((e,t,s)=>{if("fetchCreditDetails"===e.action){const t=`https://return.gst.gov.in/returns/auth/api/itcdtls?fdate=${e.from}&tdate=${e.to}`;return fetch(t,{method:"GET",credentials:"include"}).then((e=>e.json())).then((e=>s({success:!0,data:e}))).catch((e=>s({success:!1,error:e.message}))),!0}})),chrome.runtime.onMessage.addListener(((e,t,s)=>{if("fetchRtnDetails"===e.action){const t="https://return.gst.gov.in/returns/auth/api/returnstatus",n={searchBy:"",ackno:"",status:"",stdt:"",endt:"",fy:e.fy||"2024"};return fetch(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>e.json())).then((e=>s({success:!0,data:e}))).catch((e=>s({success:!1,error:e.message}))),!0}})),chrome.runtime.onMessage.addListener(((e,t,s)=>{if("imsinward"===e.action){const t=`https://return.gst.gov.in/imsweb/auth/api/ims/getInvoices?gstin=${e.gstin}&section=${e.section}`;return fetch(t,{method:"GET",credentials:"include",headers:{Accept:"application/json, text/plain, */*"}}).then((e=>e.json())).then((e=>s({success:!0,data:e}))).catch((e=>s({success:!1,error:e.message}))),!0}})),chrome.runtime.onMessage.addListener(((e,t,s)=>{if("imsSAVE"===e.action){const t="https://return.gst.gov.in/imsweb/auth/api/ims/saveAction",n=e.jdata;return fetch(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>e.json())).then((e=>s({success:!0,data:e}))).catch((e=>s({success:!1,error:e.message}))),!0}})),chrome.runtime.onMessage.addListener(((e,t,s)=>{if("imsoutward"===e.action){const t=`https://return.gst.gov.in/imsweb/auth/api/ims/getOutwardInvoices?gstin=${e.gstin}&rtnType=R1&rtnprd=${e.period}&section=${e.section}`;return fetch(t,{method:"GET",credentials:"include",headers:{Accept:"application/json, text/plain, */*"}}).then((e=>e.json())).then((e=>s({success:!0,data:e}))).catch((e=>s({success:!1,error:e.message}))),!0}})),chrome.runtime.onMessage.addListener(((e,t,s)=>{if("getNotices"===e.action){const t="https://services.gst.gov.in/litserv/auth/api/case/task/get",n={gstIn:e.gstin};return fetch(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>e.json())).then((e=>s({success:!0,data:e}))).catch((e=>s({success:!1,error:e.message}))),!0}})),chrome.runtime.onMessage.addListener(((e,t,s)=>{if("getNoticesFolders"===e.action){const t="https://services.gst.gov.in/litserv/auth/api/case/folder",n={caseId:e.cId,gstid:e.gstin,caseTypeCd:e.ctyp};return fetch(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>e.json())).then((e=>s({success:!0,data:e}))).catch((e=>s({success:!1,error:e.message}))),!0}})),chrome.runtime.onMessage.addListener(((e,t,s)=>{if("getNoticesItems"===e.action){const t="https://services.gst.gov.in/litserv/auth/api/case/folder/items",n={caseFolderId:e.fId};return fetch(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>e.json())).then((e=>s({success:!0,data:e}))).catch((e=>s({success:!1,error:e.message}))),!0}})),chrome.runtime.onMessage.addListener(((e,t,s)=>{if("allreports"===e.action){const t=`https://return.gst.gov.in/returns/auth/api/gstr3bvs1/getdata?form_type=allreports&fy=${e.slectfy}`;return fetch(t,{method:"GET",credentials:"include",headers:{Accept:"application/json, text/plain, */*"}}).then((e=>e.json())).then((e=>s({success:!0,data:e}))).catch((e=>s({success:!1,error:e.message}))),!0}})),chrome.runtime.onMessage.addListener(((e,t,s)=>{if("fetchGSTIN"===e.action){const t=Array.isArray(e.gstins)?e.gstins:[e.gstins],n=[];return console.log(t),fetch("https://services.gst.gov.in/services/api/ustatus",{method:"GET",credentials:"include",mode:"cors",headers:{accept:"application/json, text/plain, */*"},referrer:"https://services.gst.gov.in/services/auth/searchtp"}).then((e=>{const t=e.headers.get("at");if(!t)throw new Error("'at' token not found");return t})).then((async e=>{for(const s of t){var a={gstin:s};try{const t=await fetch("https://publicservices.gst.gov.in/publicservices/auth/api/search/tp",{method:"POST",headers:{accept:"application/json, text/plain","content-type":"application/json;charset=UTF-8",at:e},body:JSON.stringify(a)}),r=await t.json();n.push({gstin:s,tradeName:r?.tradeNam||"",legalName:r?.lgnm||"",status:r?.sts||"",regDate:r?.rgdt||"",types:r?.ctb||"",nature:r?.dty||"",canceldt:r?.cxdt||""})}catch(e){n.push({gstin:s,error:e.message})}}s({success:!0,results:n})})).catch((e=>{s({success:!1,error:e.message})})),!0}})),chrome.runtime.onMessage.addListener(((e,t,s)=>{if("fetchGSTINAddress"===e.action){const t=Array.isArray(e.gstins)?e.gstins:[e.gstins],n=[];return console.log(t),fetch("https://services.gst.gov.in/services/api/ustatus",{method:"GET",credentials:"include",mode:"cors",headers:{accept:"application/json, text/plain, */*"},referrer:"https://services.gst.gov.in/services/auth/searchtp"}).then((e=>{const t=e.headers.get("at");if(!t)throw new Error("'at' token not found");return t})).then((async e=>{for(const s of t){var a={gstin:s};try{const t=await fetch("https://publicservices.gst.gov.in/publicservices/auth/api/search/tp/busplaces",{method:"POST",headers:{accept:"application/json, text/plain","content-type":"application/json;charset=UTF-8",at:e},body:JSON.stringify(a)}),r=await t.json();n.push({gstin:s,address:r?.pradr?.adr||""})}catch(e){n.push({gstin:s,error:e.message})}}s({success:!0,results1:n})})).catch((e=>{s({success:!1,error:e.message})})),!0}})),chrome.runtime.onMessage.addListener(((e,t,s)=>{if("fetchGSTINFilling"===e.action){const t=Array.isArray(e.gstins)?e.gstins:[e.gstins],n=[];return console.log(t),fetch("https://services.gst.gov.in/services/api/ustatus",{method:"GET",credentials:"include",mode:"cors",headers:{accept:"application/json, text/plain, */*"},referrer:"https://services.gst.gov.in/services/auth/searchtp"}).then((e=>{const t=e.headers.get("at");if(!t)throw new Error("'at' token not found");return t})).then((async a=>{for(const s of t){var r={gstin:s,fy:e.fy};try{const e=await fetch("https://publicservices.gst.gov.in/publicservices/auth/api/search/taxpayerReturnDetails",{method:"POST",headers:{accept:"application/json, text/plain","content-type":"application/json;charset=UTF-8",at:a},body:JSON.stringify(r)}),t=await e.json();n.push({gstin:s,filingStatus:t?.filingStatus||""})}catch(e){n.push({gstin:s,error:e.message})}}s({success:!0,results2:n})})).catch((e=>{s({success:!1,error:e.message})})),!0}})),chrome.runtime.onMessage.addListener(((e,t,s)=>{if("gstr2ballmonths"===e.action){const t=e.rtnprds.map((e=>{const t=`https://gstr2b.gst.gov.in/gstr2b/auth/api/gstr2b/getdata?rtnprd=${e}`;return console.log(t),fetch(t,{method:"GET",credentials:"include"}).then((e=>e.json())).then((t=>({fy:e,success:!0,data:t}))).catch((t=>({fy:e,success:!1,error:t.message})))}));return Promise.all(t).then((e=>{s({allResults:e})})),!0}})),chrome.runtime.onMessage.addListener(((e,t,s)=>{if("gstr2aallmonths"===e.action){const t=e.rtnprds.map((e=>fetch(`https://return.gst.gov.in/returns/auth/api/offline/download/url?rtn_prd=${e}&rtn_typ=GSTR2A&file_num=1`,{method:"GET",credentials:"include"}).then((e=>e.json())).then((t=>({fy:e,success:!0,data:t}))).catch((t=>({fy:e,success:!1,error:t.message})))));return Promise.all(t).then((e=>{s({allResults:e})})),!0}})),chrome.runtime.onMessage.addListener(((e,t,s)=>{if("fetchchallansme"===e.action)return fetch("https://payment.gst.gov.in/services/api/ustatus",{method:"GET",credentials:"include",mode:"cors",headers:{accept:"application/json, text/plain, */*"},referrer:"https://payment.gst.gov.in/payment/auth/challanhistory"}).then((e=>{const t=e.headers.get("at");if(!t)throw new Error("'at' token not found");return t})).then((async t=>{try{const n=await fetch(`https://payment.gst.gov.in/payment/auth/challan/getlist?fm_dt=${e.fr}&to_dt=${e.to}&gstin=${e.gstin}`,{method:"GET",headers:{accept:"application/json, text/plain","content-type":"application/json;charset=UTF-8",at:t},referrer:"https://payment.gst.gov.in/payment/auth/challanhistory",credentials:"include",mode:"cors"});if(!n.ok)throw new Error("Challan fetch failed "+n.status);const a=await n.json();let r=[];for(let e=0;e<a.length;e++){let s=a[e].cpin,n=a[e],c=await fetchReceipt(n,s,e,t);c&&r.push(c)}s({success:!0,data:JSON.parse(JSON.stringify(r)),atToken:t})}catch(e){s({success:!1,error:e.message})}})).catch((e=>{s({success:!1,error:e.message})})),!0}));